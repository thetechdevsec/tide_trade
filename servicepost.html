<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Service</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
	<div>
		<a href="index.html" class="btn btn-primary">Back to Home</a>
		<a href="services.html" class="btn btn-primary">Back to Services</a>
	</div>
    <div class="container mt-5">
        <h2>Create New Service</h2>
        <form id="serviceForm">
            <div class="mb-3">
                <label for="category" class="form-label">Category</label>
                <select class="form-select" id="category" name="category" required>
                    <option value="">Select a category...</option>
                    <option value="Home Services">Home Services</option>
                    <option value="Personal Services">Personal Services</option>
                    <option value="Delivery and Errand Services">Delivery and Errand Services</option>
                    <option value="Plumbing">Plumbing</option>
                    <option value="Electrician">Electrician</option>
                    <option value="House Cleaning">House Cleaning</option>
                    <option value="Landscaping">Landscaping</option>
                    <option value="Painting">Painting</option>
                    <option value="Car Repair">Car Repair</option>
                    <option value="Computer Repair">Computer Repair</option>
                    <option value="Photography">Photography</option>
                    <option value="Tutoring">Tutoring</option>
                    <option value="Fitness Training">Fitness Training</option>
                    <option value="Event Planning">Event Planning</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="title" class="form-label">Title / Sub-Category</label>
                <select class="form-select" id="title" name="title" required>
                    <option value="">Select a title or sub-category...</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
            </div>
            <div class="mb-3">
                <label for="thumbnail" class="form-label">Thumbnail URL</label>
                <input type="url" class="form-control" id="thumbnail" name="thumbnail" required>
            </div>
            <div class="mb-3">
                <label for="price" class="form-label">Price</label>
                <input type="number" class="form-control" id="price" name="price" step="0.01" required>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function getUserIdFromToken(token) {
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                return payload.user_id;
            } catch (error) {
                console.error('Error decoding token:', error);
                return null;
            }
        }

        function populateTitleDropdown(category) {
            const titleSelect = document.getElementById('title');
            titleSelect.innerHTML = '<option value="">Select a title or sub-category...</option>';

            switch (category) {
                case 'Home Services':
                    titleSelect.innerHTML += `
                        <option value="Home Repair">Home Repair</option>
                        <option value="Interior Design">Interior Design</option>
                        <option value="Appliance Repair">Appliance Repair</option>
                    `;
                    break;
                case 'Personal Services':
                    titleSelect.innerHTML += `
                        <option value="Personal Training">Personal Training</option>
                        <option value="Salon Services">Salon Services</option>
                        <option value="Massage Therapy">Massage Therapy</option>
                    `;
                    break;
                case 'Delivery and Errand Services':
                    titleSelect.innerHTML += `
                        <option value="Grocery Delivery">Grocery Delivery</option>
                        <option value="Courier Service">Courier Service</option>
                        <option value="Errand Running">Errand Running</option>
                    `;
                    break;
                case 'Plumbing':
                    titleSelect.innerHTML += `
                        <option value="Pipe Installation">Pipe Installation</option>
                        <option value="Leak Repair">Leak Repair</option>
                        <option value="Drain Cleaning">Drain Cleaning</option>
                    `;
                    break;
                case 'Electrician':
                    titleSelect.innerHTML += `
                        <option value="Wiring Installation">Wiring Installation</option>
                        <option value="Fixture Installation">Fixture Installation</option>
                        <option value="Circuit Repair">Circuit Repair</option>
                    `;
                    break;
                case 'House Cleaning':
                    titleSelect.innerHTML += `
                        <option value="Regular Cleaning">Regular Cleaning</option>
                        <option value="Deep Cleaning">Deep Cleaning</option>
                        <option value="Move-in / Move-out Cleaning">Move-in / Move-out Cleaning</option>
                    `;
                    break;
                case 'Landscaping':
                    titleSelect.innerHTML += `
                        <option value="Lawn Mowing">Lawn Mowing</option>
                        <option value="Garden Design">Garden Design</option>
                        <option value="Tree Trimming">Tree Trimming</option>
                    `;
                    break;
                case 'Painting':
                    titleSelect.innerHTML += `
                        <option value="Interior Painting">Interior Painting</option>
                        <option value="Exterior Painting">Exterior Painting</option>
                        <option value="Wallpaper Installation">Wallpaper Installation</option>
                    `;
                    break;
                case 'Car Repair':
                    titleSelect.innerHTML += `
                        <option value="Brake Service">Brake Service</option>
                        <option value="Oil Change">Oil Change</option>
                        <option value="Engine Repair">Engine Repair</option>
                    `;
                    break;
                case 'Computer Repair':
                    titleSelect.innerHTML += `
                        <option value="Virus Removal">Virus Removal</option>
                        <option value="Software Installation">Software Installation</option>
                        <option value="Hardware Repair">Hardware Repair</option>
                    `;
                    break;
                case 'Photography':
                    titleSelect.innerHTML += `
                        <option value="Portrait Photography">Portrait Photography</option>
                        <option value="Event Photography">Event Photography</option>
                        <option value="Product Photography">Product Photography</option>
                    `;
                    break;
                case 'Tutoring':
                    titleSelect.innerHTML += `
                        <option value="Math Tutoring">Math Tutoring</option>
                        <option value="Language Tutoring">Language Tutoring</option>
                        <option value="Test Preparation">Test Preparation</option>
                    `;
                    break;
                case 'Fitness Training':
                    titleSelect.innerHTML += `
                        <option value="Personal Training">Personal Training</option>
                        <option value="Yoga Instruction">Yoga Instruction</option>
                        <option value="Group Fitness Classes">Group Fitness Classes</option>
                    `;
                    break;
                case 'Event Planning':
                    titleSelect.innerHTML += `
                        <option value="Wedding Planning">Wedding Planning</option>
                        <option value="Corporate Event Planning">Corporate Event Planning</option>
                        <option value="Birthday Party Planning">Birthday Party Planning</option>
                    `;
                    break;
                default:
                    titleSelect.innerHTML = '<option value="">Select a title or sub-category...</option>';
                    break;
            }
        }

        document.getElementById('category').addEventListener('change', function() {
            const selectedCategory = this.value;
            populateTitleDropdown(selectedCategory);
        });

        document.getElementById('serviceForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const accessToken = localStorage.getItem('access');
            const userId = getUserIdFromToken(accessToken);

            if (!userId) {
                alert('User ID not found. Please log in again.');
                return;
            }

            const formData = new FormData(this);
            formData.append('user', userId);

            const requestData = {
                method: 'POST',
                body: formData
            };

						fetch('https://mk-services.onrender.com/services/api/services/', requestData)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    alert('Service created successfully!');
                    document.getElementById('serviceForm').reset();
										window.location.href = 'services.html';
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error creating service. Please try again.');
                });
        });
    </script>
</body>
</html>